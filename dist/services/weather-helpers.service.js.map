{"version":3,"file":"weather-helpers.service.js","sourceRoot":"","sources":["../../src/services/weather-helpers.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { Injectable } from '@angular/core';\nimport { Forecast } from './api/weather.api.service';\nimport { ChartData } from 'chart.js';\nimport * as moment from 'moment';\n@Injectable()\nexport class WeatherHelpersService {\n  constructor() {}\n\n  groupForecastsByDay(list: Forecast[]): Array<Forecast[]> {\n    const map: { [key: string]: Forecast[] } = {};\n    let result: Array<Forecast[]> = [];\n    list.forEach(el => {\n      const day = el.data.getUTCDate();\n      if (!map[day]) {\n        map[day] = [el];\n      } else {\n        map[day].push(el);\n      }\n    });\n    result = Object.keys(map).map(key => map[key]);\n    return result;\n  }\n\n  // Fixme: This function generates wrong icon for average day weather.\n  // Weather icon is taken from first day measurement\n  reduceToAveragePerDay(list: Forecast[]) {\n    return list.reduce((prev: Forecast[], curr) => {\n      if (curr && !curr.data) {\n        prev.push(curr);\n        return prev;\n      }\n      const lastElement = function() {\n        return prev[prev.length - 1];\n      };\n      const prevDay = lastElement()\n        ? prev[prev.length - 1].data.getDay()\n        : null;\n      const currDay = curr.data.getDay();\n      if (currDay === prevDay) {\n        const result: Forecast = lastElement();\n        result.temp = (result.temp + curr.temp) / 2;\n        if (result.wind && curr.wind) {\n          result.wind = {\n            speed: (result.wind.speed + curr.wind.speed) / 2,\n            deg: (result.wind.deg + curr.wind.deg) / 2\n          };\n        }\n\n        if (result.humidity && curr.humidity) {\n          result.humidity = (result.humidity + curr.humidity) / 2;\n        }\n        if (result.pressure && curr.pressure) {\n          result.pressure = (result.pressure + curr.pressure) / 2;\n        }\n\n        prev[prev.length - 1] = result;\n        return prev;\n      } else {\n        prev.push(curr);\n        return prev;\n      }\n    }, []);\n  }\n\n  mapForecastToCharts(forecast: Forecast[], borderColor = '#aaa'): ChartData {\n    return forecast.reduce(\n      (prev: ChartData, curr: Forecast) => {\n        if (prev.labels) {\n          prev.labels.push(moment(curr.data.toISOString()).format('LT'));\n        }\n        if (prev.datasets && prev.datasets[0] && prev.datasets[0].data) {\n          const data: number[] = <number[]>prev.datasets[0].data;\n          data.push(curr.temp);\n        }\n\n        return prev;\n      },\n      <ChartData>{\n        labels: [],\n        datasets: [\n          {\n            data: [],\n            backgroundColor: ['rgba(0, 0, 0, 0.1)'],\n            borderColor: borderColor,\n            borderWidth: 1,\n            fontColor: borderColor\n          }\n        ],\n        options: {\n          scales: {\n            xAxes: [\n              {\n                type: 'time',\n                distribution: 'linear',\n                fontColor: [borderColor]\n              }\n            ]\n          }\n        }\n      }\n    );\n  }\n\n  hexToRgbA(hex: string, opacity: string) {\n    let c: any;\n    if (/^#([A-Fa-f0-9]{3}){1,2}$/.test(hex)) {\n      c = hex.substring(1).split('');\n      if (c.length === 3) {\n        c = [c[0], c[0], c[1], c[1], c[2], c[2]];\n      }\n      c = '0x' + c.join('');\n      return `rgba(${[(c >> 16) & 255, (c >> 8) & 255, c & 255].join(\n        ','\n      )},${opacity})`;\n    }\n  }\n}\n"]}